---
import { PUBLIC_API_URL } from 'astro:env/client'
import Header from '@components/layout/Header.astro'
import Sidebar from '@components/layout/Sidebar.astro'
import StatCard from '@components/ui/StatCard.astro'
import ChartCard from '@components/ui/ChartCard.astro'

const { role = 'administrador', username = 'Jason', userProfileImage = '' } = Astro.props
---

<!doctype html>
<html lang="es" data-bs-theme="auto">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="BookStudio es un sistema de biblioteca para gestionar préstamos, libros, autores y otros recursos, facilitando la administración y seguimiento de los préstamos."
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="/js/shared/setup/color-modes.js" is:inline></script>
    <script src="/js/shared/setup/sidebar-collapse.js" is:inline></script>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <link rel="stylesheet" href="/css/views/user.css" />

    <link href="/images/logo-dark.png" rel="icon" media="(prefers-color-scheme: light)" />
    <link href="/images/logo-light.png" rel="icon" media="(prefers-color-scheme: dark)" />

    <title>Dashboard - BookStudio</title>
  </head>
  <body>
    <Header userProfileImage={userProfileImage} />
    <Sidebar currentPage="/" role={role} username={username} />

    <!-- Main Content -->
    <main class="p-4 d-flex flex-column min-vh-100 bg-body">
      <!-- First Row -->
      <section class="row">
        <StatCard
          title="Libros"
          iconClass="bi-journal-bookmark"
          iconColor="primary"
          id="totalBooks"
        />

        <StatCard
          title="Autores"
          iconClass="bi-person-plus"
          iconColor="success"
          id="totalAuthors"
        />

        <StatCard title="Editoriales" iconClass="bi-map" iconColor="warning" id="totalPublishers" />
      </section>

      <!-- Second Row -->
      <section class="row">
        <StatCard title="Cursos" iconClass="bi-stickies" iconColor="info" id="totalCourses" />

        <StatCard
          title="Estudiantes"
          iconClass="bi-mortarboard"
          iconColor="secondary"
          id="totalStudents"
        />

        <StatCard
          title="Préstamos"
          iconClass="bi-file-earmark-text"
          iconColor="danger"
          id="totalLoans"
        />
      </section>

      <section class="row mt-2">
        <ChartCard
          title="Libros prestados por mes"
          iconClass="bi-journal-plus"
          chartId="borrowedBooksChart"
        />
        <ChartCard
          title="Libros devueltos por mes"
          iconClass="bi-arrow-clockwise"
          chartId="returnedBooksChart"
        />
        <ChartCard
          title="Tiempo promedio de préstamo"
          iconClass="bi-clock"
          chartId="avgLoanTimeChart"
        />
        <ChartCard
          title="Comparación de préstamos por año"
          iconClass="bi-bar-chart-line"
          chartId="loanComparisonChart"
        />
      </section>
    </main>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- External Libraries -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script
      is:inline
      set:html={`
      window.APP_CONFIG = {
        PUBLIC_API_URL: "${PUBLIC_API_URL}"
      };
    `}
    />

    <!-- Custom Scripts -->
    <script type="module" src="/js/modules/dashboard/dashboard.js"></script>
  </body>
</html>
